<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Historical Validator Rewards by Epoch</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    /* Global Styles */
    body {
      font-family: 'Montserrat', sans-serif;
      margin: 0;
      padding: 0;
      color: #333;
    }
    a {
      color: #f4ac07;
      text-decoration: none;
    }
    a:hover {
      color: #f4b833;
    }
    h1, h2, h3, h4, h5, h6 {
      font-weight: 700;
      margin-top: 2rem;
      margin-bottom: 1rem;
    }
    p {
      line-height: 1.6;
      margin-top: 1rem;
      margin-bottom: 1rem;
    }
    img {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 0 auto;
    }

    /* Header Styles */
    header {
      background-color: #f4ac07;
      padding: 2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }
    header h1 {
      color: #fff;
      font-size: 2.5rem;
      margin: 0;
      text-align: center;
    }
    header h1 br {
      display: none;
    }
    .logo-container {
      position: absolute;
      left: 2rem;
      display: flex;
      align-items: center;
    }
    .logo-container a {
      color: #fff;
      font-size: 1.2rem;
      font-weight: bold;
      margin-left: 0.5rem;
    }
    .logo-container.right {
      left: auto;
      right: 2rem;
    }
    .logo-container img {
      height: 1.6em;
      width: auto;
      margin: 0 0.5rem;
    }
    header small {
      color: #fff;
      font-size: 0.8rem;
    }

    /* Footer Styles */
    footer {
      background-color: #f4ac07;
      color: #fff;
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    footer p {
      margin: 0;
      line-height: 1.6;
    }
    footer img {
      height: 1.6em;
      width: auto;
      margin: 0 1rem;
    }

    /* Main Content Styles */
    main {
      max-width: 800px;
      margin: 2rem auto;
      padding: 0 1rem;
    }
    #chart {
      width: 100%;
      margin: 40px auto;
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 20px;
    }
    #chart h2 {
      margin-top: 0;
    }
  </style>
</head>
<body>
  <header>
    <div class="logo-container">
      <img src="https://trillium.so/pages/trillium-logo.gif" alt="Trillium Logo">
      <a href="https://trillium.so">trillium.so</a>
    </div>
    <h1>
      Solana Historical Validator Rewards | Powered by Trillium
    </h1>
    <div class="logo-container right">
      <img src="https://trillium.so/pages/trillium-logo.gif" alt="Trillium Logo">
    </div>
  </header>

  <main>
    <h3>Data Provided by Zantetsu | Shinobi Systems</h3>
    <h5>The first chart has a much larger scale than the second and shows the inflection point where Priority Fees became the biggest part of overall Validator Rewards</h5>
    <div id="chart1">
      <h3>Recent Epochs (540 and later)</h3>
      <canvas id="chart1-canvas"></canvas>
    </div>
    <div id="chart2">
      <h3>Earlier Epochs (539 and before)</h3>
      <canvas id="chart2-canvas"></canvas>
    </div>
  </main>

  <footer>
    <img src="https://trillium.so/pages/trillium-logo.gif" alt="Trillium Logo">
    <p>Trillium is passionate about Solana</p>
    <p>Your stake helps fuel the Solana ecosystem growth</p>
    <p>Join the Tri1lium revolution today!</p>
    <img src="https://trillium.so/pages/trillium-logo.gif" alt="Trillium Logo">
  </footer>

  <script>
    $.getJSON('/api/sig_prio_data', function(data) {
      console.log('Data fetched:', data);
      // Split the data into two arrays
      const recentData = data.filter(d => d.epoch >= 540);
      const earlierData = data.filter(d => d.epoch < 540);

      // Create the first chart
      const ctx1 = document.getElementById('chart1-canvas').getContext('2d');
      const chart1 = new Chart(ctx1, {
        type: 'line',
        data: {
          labels: recentData.map(d => d.epoch),
          datasets: [
            {
              label: 'Signature Fees / Block Rewards (SOL)',
              data: recentData.map(d => d.total_signature_fees_sol || null),
              borderColor: 'rgba(255, 99, 132, 1)',
              backgroundColor: 'rgba(255, 99, 132, 0.2)',
              pointRadius: 5,
              pointHoverRadius: 7,
              spanGaps: true
            },
            {
              label: 'Priority Fees (SOL)',
              data: recentData.map(d => d.total_priority_fees_sol || null),
              borderColor: 'rgba(54, 162, 235, 1)',
              backgroundColor: 'rgba(54, 162, 235, 0.2)',
              pointRadius: 5,
              pointHoverRadius: 7,
              spanGaps: true
            }
          ]
        },
        options: {
          title: {
            display: true,
            text: 'Solana Validator Rewards by Epoch'
          },
          scales: {
            yAxes: [{
              ticks: {
                beginAtZero: true
              }
            }]
          },
          tooltips: {
            callbacks: {
              label: function(tooltipItem, data) {
                const dataset = data.datasets[tooltipItem.datasetIndex];
                const value = dataset.data[tooltipItem.index];
                return `${dataset.label}: ${value.toFixed(2)}`;
              }
            }
          }
        }
      });

      // Create the second chart
      const ctx2 = document.getElementById('chart2-canvas').getContext('2d');
      const chart2 = new Chart(ctx2, {
        type: 'line',
        data: {
          labels: earlierData.map(d => d.epoch),
          datasets: [
            {
              label: 'Signature Fees / Block Rewards (SOL)',
              data: earlierData.map(d => d.total_signature_fees_sol || null),
              borderColor: 'rgba(255, 99, 132, 1)',
              backgroundColor: 'rgba(255, 99, 132, 0.2)',
              pointRadius: 5,
              pointHoverRadius: 7,
              spanGaps: true
            },
            {
              label: 'Priority Fees (SOL)',
              data: earlierData.map(d => d.total_priority_fees_sol || null),
              borderColor: 'rgba(54, 162, 235, 1)',
              backgroundColor: 'rgba(54, 162, 235, 0.2)',
              pointRadius: 5,
              pointHoverRadius: 7,
              spanGaps: true
            }
          ]
        },
        options: {
          title: {
            display: true,
            text: 'Solana Validator Rewards by Epoch'
          },
          scales: {
            yAxes: [{
              ticks: {
                beginAtZero: true
              }
            }]
          },
          tooltips: {
            callbacks: {
              label: function(tooltipItem, data) {
                const dataset = data.datasets[tooltipItem.datasetIndex];
                const value = dataset.data[tooltipItem.index];
                return `${dataset.label}: ${value.toFixed(2)}`;
              }
            }
          }
        }
      });
    });
  </script>
</body>
</html>