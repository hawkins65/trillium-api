-- Save as stake_statistics.sql
\copy (SELECT epoch, MIN(account_balance) as min_account_balance, MAX(account_balance) as max_account_balance, AVG(account_balance)::bigint as mean_account_balance, PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY account_balance)::bigint as median_account_balance, SUM(account_balance) as total_account_balance, MIN(credits_observed) as min_credits_observed, MAX(credits_observed) as max_credits_observed, AVG(credits_observed)::bigint as mean_credits_observed, PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY credits_observed)::bigint as median_credits_observed, SUM(credits_observed) as total_credits_observed, MIN(delegated_stake) as min_delegated_stake, MAX(delegated_stake) as max_delegated_stake, AVG(delegated_stake)::bigint as mean_delegated_stake, PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY delegated_stake)::bigint as median_delegated_stake, SUM(delegated_stake) as total_delegated_stake, MIN(active_stake) as min_active_stake, MAX(active_stake) as max_active_stake, AVG(active_stake)::bigint as mean_active_stake, PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY active_stake)::bigint as median_active_stake, SUM(active_stake) as total_active_stake, MIN(deactivating_stake) as min_deactivating_stake, MAX(deactivating_stake) as max_deactivating_stake, AVG(deactivating_stake)::bigint as mean_deactivating_stake, PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY deactivating_stake)::bigint as median_deactivating_stake, SUM(deactivating_stake) as total_deactivating_stake FROM stake_accounts GROUP BY epoch ORDER BY epoch) TO '/home/smilax/api/stake-statistics.csv' WITH (FORMAT CSV, HEADER)